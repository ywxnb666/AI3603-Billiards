# 新版 NewAgent 重构与优化思路（参考 Pro 框架）

目标优先级：
- 首要：当前一杆能否稳定进球（进攻优先）。
- 次要：在不牺牲进球率的前提下，显著降低犯规概率（白球/黑8风险管理）。
- 再次：轻量考虑下一杆的连击/防守启发奖励（不喧宾夺主）。

核心改动：
- 框架：沿用 BasicAgentPro 的“候选动作 + UCB 预算分配”流程，保留以噪声仿真评估候选的思想。
- 奖励增强：
	- 白球到任一袋口的最小距离惩罚：白球越靠近袋口，越容易 scratch（白球进袋），因此给予上限裁剪的负奖励。
	- 清台前黑8风险惩罚：黑8被碰、被明显推向袋口、或停在袋口附近均会被惩罚，以减少误送黑8导致的败局概率。
	- 连击轻量启发：在“本杆进球且未白球进袋”的条件下，估计下一杆可进球潜力，给予较小权重的奖励（主次分明）。
- 候选动作生成增强：
	- 袋口容差：在目标袋口附近施加侧向偏移，扩大可进线路的覆盖，提高进球率与抗噪性。
	- 参数冗余：phi 多档微扰、V0 既有缩放也有加性扰动；自适应加入 a/b（旋转相关）与轻微 theta（抬杆角度）候选，在长距离或大切角时更丰富。
	- 柔和安全候选：在几何较难的线路上，注入低力度、低扰动的合法首碰“软击”版本，提高抗噪与犯规回避的鲁棒性（不以防守为主，仅作为困难场景的稳健补充）。
- 仿真与性能：
	- 使用“轻量复制球对象”（不复制历史）+ Windows 下的软事件上限，避免仿真卡死；Unix 支持 SIGALRM 硬超时。
	- 噪声注入覆盖 `V0/phi/theta/a/b`，与 poolenv 接近或略大，提升对真实环境中的误差鲁棒性。

与 Pro 的差异与预期收益：
- 候选更丰富：不仅应对角度噪声（phi），同时自适应地覆盖力度、旋转与轻微抬杆，且对袋口进行侧向偏移；在复杂线路下有更高的成功率。
- 犯规概率更低：白球/黑8的袋口风险显式计入奖励，能有效减少关键犯规（白球进袋/误送黑8）。
- 连击启发但不过度：只有在本杆进球时才小幅鼓励下一杆的可进球潜力，不会影响“当前能否进球”的第一优先级。

进一步可探索方向：
- 智能防守策略（次要）：当判定本局面进球概率极低时，加入安全球/藏球的目标化候选（需要更深入的路径与遮挡评估）。
- 噪声相关性建模：让 `phi` 与 `a/b` 的噪声存在一定相关结构，拟合真实击球误差分布。
- 自适应仿真预算：根据候选稳定性与先验分数进行“进阶 UCB”或“渐进加宽”，提升预算分配效率。

文件位置：
- 主要实现：agents/new_agent.py（中文注释已补充）。
- 评估入口：evaluate.py（Agent B 默认使用 NewAgent）。

